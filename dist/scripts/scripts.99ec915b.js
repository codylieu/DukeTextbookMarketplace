"use strict";angular.module("dukeTextbookMarketplaceApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/textbook.html",controller:"TextbookCtrl"}).when("/textbook",{templateUrl:"views/textbook.html",controller:"TextbookCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]).factory("currentUser",function(){return{netid:""}}),angular.module("dukeTextbookMarketplaceApp").controller("TextbookCtrl",["$scope","$location","$http","currentUser","$modal",function(a,b,c,d,e){a.currentUser=d,a.allTextbooks=[],a.departments=[],a.alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],c.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/selectListingInfo.php?callback=json_callback").success(function(b){a.allTextbooks=b,a.departments=_.uniq(_.pluck(a.allTextbooks,"deptName"))}),a.selectedDepartment="African and African American Studies",a.switchDepartment=function(b){a.selectedDepartment=b},a.showDepartment=function(b){return b.substring(0,1)==a.selectedLetter},a.selectedLetter="A",a.switchLetter=function(b){a.selectedLetter=b},a.showTextbook=function(b){return b.deptName==a.selectedDepartment&&b.deptName.substring(0,1)==a.selectedLetter},a.viewSellers=function(a){e.open({templateUrl:"views/viewSellersModal.html",controller:"ViewSellersModalInstanceCtrl",resolve:{book:function(){return a}}})},a.watchTextbook=function(b){c.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/watching/insert.php?netid='"+a.currentUser.netid+"'&isbn='"+b.isbn+"'")},a.goToAccount=function(){b.path("account")},a.logout=function(){b.path("login")}}]),angular.module("dukeTextbookMarketplaceApp").controller("AccountCtrl",["$scope","$modal","$log","$location","currentUser","$http","$route",function(a,b,c,d,e,f,g){a.currentUser=e,a.books=[],f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/selectUserTextbooks.php?netid="+a.currentUser.netid).success(function(b){a.books=b}),a.user={},f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/Users/select.php?netid="+a.currentUser.netid).success(function(b){a.user=b[0]}),a.watching=[],f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/selectUserWatchings.php?netid="+a.currentUser.netid).success(function(b){a.watching=b}),a.listings=[],a.listingsIncrementer,f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/selectAllListing.php").success(function(b){a.listings=b,a.listingsIncrementer=_.last(a.listings).listing_id,console.log("incrementer: "+a.listingsIncrementer)}),a.tabs=[{name:"My Books",active:!0},{name:"Watching",active:!1},{name:"Contact Info",active:!1}],a.switchTabs=function(b){_.each(a.tabs,function(a){a.active=b==a.name})},a.addTextbook=function(){var c=b.open({templateUrl:"views/addTextbookModal.html",controller:"AddTextbookModalInstanceCtrl"});c.result.then(function(b){a.listingsIncrementer++,f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/listings/insert.php?listing_id='"+a.listingsIncrementer+"'&netid='"+a.currentUser.netid+"'&isbn='"+b.isbn+"'&conditionOfBook='"+b.condition+"'&statusOfBook='1'&price='"+b.price+"'").success(function(a){console.log(a)}),g.reload()})},a.deleteTextbook=function(c){var d=b.open({templateUrl:"views/deleteTextbookModal.html",controller:"DeleteTextbookModalInstanceCtrl",resolve:{book:function(){return c}}});d.result.then(function(b){if(b){a.books=_.without(a.books,c);var d=_.filter(a.listings,function(b){return b.netid==a.currentUser.netid&&b.isbn==c.isbn}),e=d[0].listing_id;f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/listings/delete.php?listing_id='"+e+"'&netid='"+a.currentUser.netid+"'&isbn='"+c.isbn+"'")}})},a.editTextbookListing=function(c){var d=b.open({templateUrl:"views/editTextbookListingModal.html",controller:"EditTextbookListingModalInstanceCtrl",resolve:{book:function(){return c}}});d.result.then(function(b){a.books[_.indexOf(a.books,c)]=b;var d=_.filter(a.listings,function(c){return c.netid==a.currentUser.netid&&c.isbn==b.isbn}),e=d[0].listing_id;f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/listings/update.php?listing_id='"+e+"'&netid='"+a.currentUser.netid+"'&isbn='"+b.isbn+"'&date='"+b.date+"'&statusOfBook='1'&conditionOfBook='"+b.conditionOfBook+"'&price='"+b.price+"'")})},a.unwatchTextbook=function(b){a.watching=_.without(a.watching,b),f.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/watching/delete.php?netid='"+a.currentUser.netid+"'&isbn='"+b.isbn+"'")},a.editContactInfo=function(){var c=b.open({templateUrl:"views/editContactInfoModal.html",controller:"EditContactInfoModalInstanceCtrl",resolve:{user:function(){return a.user}}});c.result.then(function(b){a.user=b})},a.isAddTextbookButtonDisabled=function(){return""==a.textbookName||""==a.textbookISBN||""==a.textbookCourse},a.goToFindBooks=function(){d.path("textbook")},a.logout=function(){a.currentUser.netid="",d.path("login")},a.viewSellers=function(a){b.open({templateUrl:"views/viewSellersModal.html",controller:"ViewSellersModalInstanceCtrl",resolve:{book:function(){return a}}})}}]),angular.module("dukeTextbookMarketplaceApp").controller("AddTextbookModalInstanceCtrl",["$scope","$modalInstance",function(a,b){a.textbookDetails={isbn:"",price:"",condition:""},a.addTextbook=function(){b.close(a.textbookDetails)},a.isAddTextbookButtonDisabled=function(){return""==a.textbookDetails.isbn||""==a.textbookDetails.price||""==a.textbookDetails.condition},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("dukeTextbookMarketplaceApp").controller("DeleteTextbookModalInstanceCtrl",["$scope","$modalInstance","book",function(a,b,c){a.textbook=c,a.deleteTextbook=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("dukeTextbookMarketplaceApp").controller("EditTextbookListingModalInstanceCtrl",["$scope","$modalInstance","book",function(a,b,c){a.textbook=_.clone(c),a.updateTextbook=function(){b.close(a.textbook)},a.cancel=function(){b.dismiss("cancel")},a.isUpdateTextbookButtonDisabled=function(){return _.isEqual(a.textbook,c)}}]),angular.module("dukeTextbookMarketplaceApp").controller("EditContactInfoModalInstanceCtrl",["$scope","$modalInstance","user","$http",function(a,b,c,d){a.user=_.clone(c),a.updateContactInfo=function(){b.close(a.user),d.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/Users/update.php?netid='"+a.user.netid+"'&firstName='"+a.user.firstName+"'&lastName='"+a.user.lastName+"'&major='"+a.user.major+"'&phoneNumber='"+a.user.phoneNumber+"'")},a.cancel=function(){b.dismiss("cancel")},a.isUpdateContactInfoButtonDisabled=function(){return _.isEqual(a.user,c)}}]),angular.module("dukeTextbookMarketplaceApp").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("dukeTextbookMarketplaceApp").controller("LoginCtrl",["$scope","$http","currentUser","$location",function(a,b,c,d){a.currentUser=c,a.netid="",a.newNetid="",a.newUser={netid:"",firstName:"",lastName:"",phoneNumber:"",major:""},a.login=function(){b.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/Users/select.php?netid="+a.netid).success(function(b){a.user=b,_.isEmpty(a.user)?a.loginFailed=!0:(a.loginFailed=!1,a.currentUser.netid=a.netid,d.path("account"))})},a.register=function(){b.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/Users/insert.php?netid='"+a.newUser.netid+"'&firstName='"+a.newUser.firstName+"'&lastName='"+a.newUser.lastName+"'&major='"+a.newUser.major+"'&phoneNumber='"+a.newUser.phoneNumber+"'"),a.currentUser.netid=a.newUser.netid,d.path("account")},a.isRegisterButtonDisabled=function(){return _.isEmpty(a.newUser.netid)||_.isEmpty(a.newUser.firstName)||_.isEmpty(a.newUser.lastName)||_.isEmpty(a.newUser.phoneNumber)||_.isEmpty(a.newUser.major)}}]),angular.module("dukeTextbookMarketplaceApp").controller("ViewSellersModalInstanceCtrl",["$scope","$modalInstance","$http","book",function(a,b,c,d){a.book=d,a.relevantListings=[],a.relevantUsers=[],c.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/selectAllListing.php").success(function(b){a.relevantListings=_.filter(b,function(a){return a.isbn==d.isbn}),_.each(a.relevantListings,function(b){c.get("http://colab-sbx-211.oit.duke.edu/DukeTextbookMarketplace/PHPDatabaseCalls/Users/select.php?netid="+b.netid).success(function(b){console.log(b[0]),a.relevantUsers.push(b[0])})})}),a.noRelevantListings=function(){return _.isEmpty(a.relevantListings)},a.OK=function(){b.dismiss("OK")}}]);